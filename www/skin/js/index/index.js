'use strict';$('body').on("click", ".addBtn", function(e){    e.stopPropagation();    var button_id = $(this).attr('id');    var _id= button_id.replace('addBtn-','');    var commentTxt_Input=$('#commentTxt-'+_id);    var username_Input=$('#username-'+_id);    var comment = commentTxt_Input.val();    var username =username_Input.val();    var parent_id = _id;    if(comment.length>0 && username.length>0) {        $.ajax({            type: 'POST',            url: '/index/addcomment',            beforeSend: function () {                //disable form so now data can be double inserted nor double clicked                commentTxt_Input.disabled=true;                username_Input.disabled=true;                $(this).disabled=true;            },            data: {"comment": comment, "username": username, "parent_id": parent_id},            success: function (data) {                if (data.status.code == 200) {                    getComments();                } else if (data.status.code == 300) {                    //place errors here later                    $('#statusDiv').html("<span style='color:red'>"+data.status.msg+"</span>");                }                //enable if necessary                if($(this).isDisabled) { //should only apply to top level comment                    commentTxt_Input.disabled = false;                    username_Input.disabled = false;                    $(this).disabled = false;                }                //clear if necessary- should only apply to top level comment                if(commentTxt_Input.val().length>0)                    commentTxt_Input.val('');                if(username_Input.val().length>0)                    username_Input.val('');            }        });    }else{        $('#statusDiv').html("<span style='color:red'>Comment and username are required fields.</span>");    }    return false;});$('body').on("click", ".showBtn", function(e){    e.stopPropagation();    var button_id = $(this).attr('id');    var _id= button_id.replace('showBtn-','');    //Show the comment form    if($('#comment-'+_id).is(":hidden")) {        $('#comment-' + _id).show();        $(this).html('Hide');    }else{        $('#comment-' + _id).hide();        $(this).html('Reply');    }    return false;});function getComments() {    var comments=null;    $.ajax({        type: 'POST',        url: '/index/getcomments',        beforeSend: function () {        },        data: {},        success: function (response) {            if (response.status.code == 200) {                comments= response.data.comments;                var commentObjs=JSON.parse(comments);                processNestedComments(commentObjs);            } else if (data.status.code == 300) {            }        }    });}function processNestedComments(commentObjs){    var html='<br/>';    $.each(commentObjs, function(i, aComment) {        html+='<div class="media"><img class="mr-3" src="https://via.placeholder.com/40x40" alt="Generic placeholder image"><div class="media-body"><h5 class="mt-0">'+aComment.username+'&nbsp;<small>'+aComment.datetime+'</small></h5>'+aComment.comment;        var form1=createCommentAddForm(aComment.comment_id);        html+=form1;        $.each(aComment.children, function(i, aComment) {            html+='<div class="media mt-3"> <a class="pr-3" href="#"><img src="https://via.placeholder.com/40x40" alt="Generic placeholder image"></a><div class="media-body"><h5 class="mt-0">'+aComment.username+'&nbsp;<small>'+aComment.datetime+'</small></h5>'+aComment.comment;            var form2=createCommentAddForm(aComment.comment_id);            html+=form2;            $.each(aComment.children, function(i, aComment) {                html+='<div class="media mt-3"> <a class="pr-3" href="#"><img src="https://via.placeholder.com/40x40" alt="Generic placeholder image"></a><div class="media-body"><h5 class="mt-0">'+aComment.username+'&nbsp;<small>'+aComment.datetime+'</small></h5>'+aComment.comment;                //var form3=createCommentAddForm(aComment.comment_id);               // html+=form3;               /* $.each(aComment.children, function(i, aComment) {                    html+='<div class="media mt-3"> <a class="pr-3" href="#"><img src="https://via.placeholder.com/40x40" alt="Generic placeholder image"></a><div class="media-body"><h5 class="mt-0">'+aComment.username+'&nbsp;<small>'+aComment.datetime+'</small></h5>'+aComment.comment;                    var form4=createCommentAddForm(aComment.comment_id);                    html+=form4;                    $.each(aComment.children, function(i, aComment) {                        html+='<div class="media mt-3"> <a class="pr-3" href="#"><img src="https://via.placeholder.com/40x40" alt="Generic placeholder image"></a><div class="media-body"><h5 class="mt-0">'+aComment.username+'&nbsp;<small>'+aComment.datetime+'</small></h5>'+aComment.comment;                        var form5=createCommentAddForm(aComment.comment_id);                        html+=form5;                        $.each(aComment.children, function(i, aComment) {                            html+='<div class="media mt-3"> <a class="pr-3" href="#"><img src="https://via.placeholder.com/40x40" alt="Generic placeholder image"></a><div class="media-body"><h5 class="mt-0">'+aComment.username+'&nbsp;<small>'+aComment.datetime+'</small></h5>'+aComment.comment;                           // var form6=createCommentAddForm(aComment.comment_id);                           // html+=form6;                            html+='</div> </div>';                        });                        html+='</div> </div>';                    });                    html+='</div> </div>';                });*/                html+='</div> </div>';            });            html+='</div> </div>';        });        html+='</div> </div>';    });    $('#comments').html(html);}function createCommentAddForm(parent_id){    var form='<br /><a href="#" id="showBtn-'+parent_id+'" class="showBtn" >Reply</a><br/><form id="comment-'+parent_id+'" class="form-inline" style="display:none"><input id="commentTxt-'+parent_id+'" class="form-control" type="text" placeholder="Enter Comment" aria-label="Comment">&nbsp;<input  id="username-'+parent_id+'" class="form-control" type="text" placeholder="Username" aria-label="Name">&nbsp;<button id="addBtn-'+parent_id+'" class="addBtn btn-outline-success" type="button">Reply</button></form>';    return form;}getComments();